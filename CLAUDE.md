# Dark Rust - 프로젝트 체크포인트

## 🔴 중요: 세션 종료 시 체크포인트 생성
**모든 Claude 세션 종료 전에 반드시 체크포인트를 생성하세요!**
```
"현재까지의 작업을 checkpoint로 저장해줘"
```
이렇게 하면 다음 세션에서 이전 컨텍스트를 완벽하게 복구할 수 있습니다.

## 프로젝트 개요
**Dark Rust**: Rust + Bevy 엔진으로 개발하는 3D 소울라이크 액션 게임

## 최근 업데이트 (2025-08-06)
- **맵 밀도 대폭 강화**: 사용자 피드백 "전체적으로 월드가 너무 텅 비어 있네" 반영
- **전체 월드맵 완성**: 6개 모든 구역에 환경 오브젝트 배치 완료
- **구역별 특화 오브젝트 구현** (밀도 3-5배 증가):
  - Z1 순례자의 오르막길: 바위(60→150개), 죽은 나무, 폐허 벽, 부서진 기둥, 뼈더미, 나무 상자, 부서진 울타리
  - Z2 수정화된 숲: 발광 수정 나무(25→80개), 수정 형성물(40→120개), 작은 수정 파편(200개), 부패한 바위(60개)
  - Z3 가라앉은 도시: 침수된 건물(8→25개), 가고일 석상(15→60개), 잔해(150개), 부서진 기둥(40개), 수중 식물(80개)
  - Z4 중력 이상 광산: 부유하는 바위(20→80개), 채굴 장비(10→40개), 광산 트랙(30개), 중력 이상 구역(50개), 지지대(60개)
  - Z5 황금빛 요새: 요새 벽(8→24개, 이중 벽), 황금 석상(12→50개), 경비탑(8개), 깃발(40개), 황금 화로(30개), 무기 거치대(60개)
  - Z6 왕관의 심장부: 거대한 왕관 파편(6→12개), 작은 파편(60개), 에너지 빔(30개), 중앙 소용돌이, 부유 플랫폼(20개)
- **연속된 월드맵 구성**: 각 구역이 연결된 위치에 배치
- **프로시저럴 배치 시스템**: 바위 클러스터, 경로 표시, 랜덤 배치

### 이전 업데이트 (2025-08-05)
- Aurora 캐릭터 모델로 전환 완료
- 애니메이션 FSM 시스템 구현 (8가지 상태)
- FBX → GLTF 변환 스크립트 작성
- 카메라 전환 속도 개선 (1.5배)
- 스페이스 키 충돌 해결 (커서 토글 → Tab)

## 현재 구현 상태 (Phase 1 MVP 완료 + 애니메이션 시스템)

### ✅ 완료된 핵심 시스템

1. **기본 프로젝트 구조**
   - Bevy 0.15 + Rapier3D 물리엔진 설정
   - ECS 아키텍처 기반 모듈화 구조
   - 개발/릴리즈 빌드 최적화 설정

2. **플레이어 시스템**
   - WASD 이동 및 마우스 시점 변경
   - 체력(HP) 100, 스테미나 100 시스템
   - 캡슐 모양 물리 바디 (충돌 처리)

3. **전투 시스템**
   - 마우스 좌클릭 기본 공격
   - 무기 시스템 (데미지, 쿨다운)
   - 히트박스 시스템 (공격 범위 감지)
   - 공격 이펙트 표시

4. **적 AI 시스템**
   - 기본 적 엔티티 (초록색 캡슐)
   - 플레이어 추적 AI (거리 기반)
   - 적 공격 시스템
   - 체력 50 설정

5. **카메라 시스템**
   - 3인칭 추적 카메라
   - 플레이어 뒤 5유닛 거리 유지

6. **UI 시스템**
   - 체력바 (좌상단)
   - 스테미나바 (체력바 아래)
   - 소울 카운터 (우상단)
   - 기본 HUD 레이아웃

7. **게임 상태 관리**
   - GameState: Playing/Paused/Death
   - 상태별 시스템 분리
   - 일시정지/사망 화면 기본 구조

### 📁 파일 구조
```
src/
├── main.rs                    # 게임 진입점, 시스템 등록
├── components/               # ECS 컴포넌트
│   ├── combat.rs            # 무기, 공격 상태
│   ├── enemy.rs             # 적 AI, 상태
│   ├── player.rs            # 플레이어 컴포넌트
│   ├── stats.rs             # 체력, 스테미나, 소울
│   └── ui.rs                # UI 관련 컴포넌트
├── systems/                 # ECS 시스템
│   ├── camera.rs            # 카메라 추적
│   ├── combat.rs            # 전투 로직
│   ├── enemy_ai.rs          # 적 AI 로직
│   ├── input.rs             # 입력 처리
│   ├── player_movement.rs   # 플레이어 이동
│   ├── ui.rs                # UI 업데이트
│   ├── simple_world.rs      # 간단한 월드 생성
│   ├── world_generation.rs  # 월드 생성 시스템
│   └── world_objects.rs     # 월드 오브젝트 정의
├── resources/               # 글로벌 리소스
│   └── input.rs             # 입력 매핑
└── states/                  # 게임 상태
    └── mod.rs               # 상태 정의
```

### 🎮 현재 게임플레이 기능
- **이동**: WASD 키로 플레이어 이동
- **시점**: 마우스로 카메라 회전  
- **공격**: 마우스 좌클릭으로 공격
- **전투**: 적 감지 시 자동 추적 및 교전
- **UI**: 실시간 체력/스테미나/소울 표시

### 🔧 기술 스택
- **엔진**: Bevy 0.15
- **물리**: bevy_rapier3d 0.28  
- **언어**: Rust 2021 edition
- **아키텍처**: ECS (Entity-Component-System)

## 📋 다음 구현 단계 (Phase 2)

### 🚀 우선순위 높음
1. **회피 시스템**
   - 스페이스바 롤링 회피
   - 무적 프레임 구현
   - 스테미나 소모

2. **사망/부활 시스템**
   - 체력 0시 사망 상태 전환
   - 소울 드롭 (사망 위치에 남김)
   - 체크포인트에서 부활

3. **체크포인트 시스템**
   - 횃불 형태 체크포인트
   - 상호작용으로 활성화
   - 부활 지점 설정

### 🎯 우선순위 중간
4. **강공격 시스템**
   - 마우스 우클릭 차지 공격
   - 더 높은 데미지, 긴 쿨다운

5. **방어 시스템**  
   - Shift키 방패 방어
   - 데미지 감소, 스테미나 소모

6. **소울 시스템**
   - 적 처치 시 소울 획득
   - 사망 시 소울 드롭
   - 소울 회수 메커니즘

### 🏗️ Phase 3 계획
- 보스 AI (패턴 기반 공격)
- 레벨 디자인 (던전, 함정)
- 사운드 시스템
- 애니메이션 시스템

## 🌍 월드 디자인 - "부서진 왕관과 중력 역병"

### 월드 컨셉
고대 산악 왕국이 하늘의 수정 모노리스('왕관') 파괴로 인해 중력 이상과 수정 역병에 몰락한 세계. 플레이어는 재앙의 근원인 '왕관의 심장부'로 향합니다.

### 주요 지역 (4km x 4km)

#### Z1. 순례자의 오르막길 (시작 지점)
- **컨셉**: 튜토리얼 지역, 황량한 산길
- **주요 요소**: 각성의 동굴, 위태로운 절벽길, 검문소 폐허
- **체크포인트**: 검문소 폐허

#### Z2. 수정화된 숲
- **컨셉**: 수정으로 변이된 기괴한 숲
- **주요 요소**: 발광 수정 나무, 소음 함정, 파편 추락지(미니보스)
- **특징**: 은신 플레이, 시야 제한

#### Z3. 가라앉은 도시 에델
- **컨셉**: 호수에 잠긴 고딕 도시
- **주요 요소**: 지붕 플랫포밍, 침수 광장, 대성당(숏컷)
- **특징**: 극단적 수직성, 수중 전투

#### Z4. 중력 이상 광산
- **컨셉**: 중력이 뒤틀린 채굴장
- **주요 요소**: 부유 바위 플랫폼, 중력 제어 퍼즐, 수직 갱도
- **특징**: 중력 변화, 3D 플랫포밍

#### Z5. 황금빛 요새 (레거시 던전)
- **컨셉**: 최정예 병력의 고밀도 던전
- **주요 요소**: 자동 방어 시스템, 복잡한 미로, 숏컷 네트워크
- **특징**: 고난이도, 숨겨진 통로

#### Z6. 왕관의 심장부 (최종 지역)
- **컨셉**: 공중 부유 최종 보스 아레나
- **주요 요소**: 파편 소용돌이, 공허의 제단
- **특징**: 동적 환경 변화, 중력 역전

### 기술적 구현 계획
- **월드 스트리밍**: 256m x 256m 청크 단위 로딩
- **LOD 시스템**: 3-4단계 디테일 레벨
- **오클루전 컬링**: 복잡한 구조물 최적화
- **모듈러 에셋**: 재사용 가능한 건축 요소

## 💡 개발 팁

### 빌드 명령어
```bash
# 개발용 실행
cargo run

# 릴리즈 빌드
cargo build --release
```

### 디버깅
- Rapier 물리 디버그 렌더링 활성화됨
- F12로 물리 콜라이더 시각화 가능

### 성능 최적화
- dev 프로파일: opt-level = 1 (컴파일 속도 vs 성능 균형)
- release 프로파일: LTO, panic=abort 설정

## 🎮 소울라이크 핵심 메커니즘 체크리스트

- ✅ 도전적인 전투 (기본 공격/적 AI)
- ✅ 체력/스테미나 관리
- ⏳ 사망시 리스크 (소울 드롭)
- ⏳ 체크포인트 시스템
- ⏳ 회피 메커니즘
- ❌ 방어 시스템
- ❌ 보스 전투
- ❌ 레벨 탐험 요소

### 🗺️ 월드맵 구성
각 구역은 연결된 하나의 거대한 맵으로 구성되어 있으며, 플레이어는 자유롭게 이동 가능:

| 구역 | 위치 오프셋 | 특징 |
|------|------------|------|
| Z1 순례자의 오르막길 | (0, 0, 0) | 시작 지점, 체크포인트 |
| Z2 수정화된 숲 | (300, 20, -200) | 동쪽, 발광 수정 |
| Z3 가라앉은 도시 | (-300, -30, -200) | 서쪽, 낮은 지대 |
| Z4 중력 이상 광산 | (0, 50, -500) | 북쪽, 높은 지대 |
| Z5 황금빛 요새 | (0, 100, -800) | 최북단, 최고 지대 |
| Z6 왕관의 심장부 | (0, 200, -1100) | 공중 부유 |

---
**체크포인트 작성일**: 2025-08-06  
**마지막 빌드 상태**: 컴파일 성공 (warnings 있음)  
**현재 상태**: 전체 월드맵 완성, 6개 구역 모두 구현됨, 오브젝트 밀도 대폭 증가  
**다음 목표**: 
1. 플레이어 스폰 위치 조정 (Z1 체크포인트 근처)
2. 지형 변화 추가 (언덕, 계곡 등)
3. 성능 최적화 (LOD, 컬링)
4. 빌드 문제 해결 (링커 에러)